<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGBA图片展示与背景控制工具</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .content {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .controls {
            flex: 1;
            min-width: 300px;
            background: rgba(20, 30, 48, 0.85);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }
        
        .preview {
            flex: 2;
            min-width: 400px;
            background: rgba(0, 0, 0, 0.25);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .control-group {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }
        
        .control-group h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #ff7e5f;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upload-area {
            border: 2px dashed #4a9df0;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(74, 157, 240, 0.1);
            margin-bottom: 20px;
        }
        
        .upload-area:hover {
            background: rgba(74, 157, 240, 0.2);
            transform: translateY(-3px);
        }
        
        .upload-area i {
            font-size: 3rem;
            color: #4a9df0;
            margin-bottom: 15px;
        }
        
        .upload-text {
            font-size: 1.1rem;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .slider-container {
            margin: 25px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .slider {
            width: 100%;
            height: 12px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #000, #fff);
            border-radius: 10px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #ff7e5f;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 126, 95, 0.7);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-clear {
            background: linear-gradient(to right, #4a9df0, #6a5af9);
        }
        
        .preview-container {
            width: 100%;
            height: 500px;
            background: 
                linear-gradient(45deg, #ccc 25%, transparent 25%), 
                linear-gradient(-45deg, #ccc 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #ccc 75%),
                linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 25px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3);
        }
        
        #backgroundDisplay {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        #foregroundImage {
            position: absolute;
            top: 0;
            left: 0;
            max-width: 100%;
            max-height: 100%;
            display: block;
            margin: auto;
            object-fit: contain;
        }
        
        .image-info {
            background: rgba(20, 30, 48, 0.85);
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            font-size: 1rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .instructions {
            background: rgba(255, 126, 95, 0.2);
            border-left: 4px solid #ff7e5f;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 20px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #feb47b;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .controls, .preview {
                min-width: 100%;
            }
            
            .preview-container {
                height: 400px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
        }
        
        .color-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            vertical-align: middle;
            margin-left: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .status {
            padding: 10px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            display: none;
        }
        
        .status.success {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid #2ecc71;
            display: block;
        }
        
        .status.error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-image"></i> RGBA图片展示与背景控制工具</h1>
            <p class="subtitle">上传带有透明通道的PNG图片，自定义背景灰度或上传背景图片，实时预览效果</p>
        </header>
        
        <div class="content">
            <div class="controls">
                <div class="control-group">
                    <h2><i class="fas fa-file-upload"></i> 上传RGBA图片</h2>
                    <div class="upload-area" id="foregroundUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p class="upload-text">点击或拖放RGBA图片到此处</p>
                        <p class="upload-hint">(支持PNG格式)</p>
                    </div>
                    <input type="file" id="foregroundInput" accept="image/png">
                    <div id="foregroundStatus" class="status"></div>
                </div>
                
                <div class="control-group">
                    <h2><i class="fas fa-sliders-h"></i> 背景灰度控制</h2>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>背景灰度值: <span id="grayscaleValue">127</span></span>
                            <span>当前颜色: <div class="color-indicator" id="colorIndicator" style="background-color: rgb(127, 127, 127)"></div></span>
                        </div>
                        <input type="range" min="0" max="255" value="127" class="slider" id="grayscaleSlider">
                    </div>
                    <p>调整滑块改变背景灰度值 (0=黑色, 255=白色)</p>
                </div>
                
                <div class="control-group">
                    <h2><i class="fas fa-images"></i> 背景图片</h2>
                    <div class="upload-area" id="backgroundUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p class="upload-text">点击或拖放背景图片到此处</p>
                        <p class="upload-hint">(支持JPG/PNG格式)</p>
                    </div>
                    <input type="file" id="backgroundInput" accept="image/*">
                    <button class="btn btn-clear" id="clearBackgroundBtn">清除背景图片</button>
                    <div id="backgroundStatus" class="status"></div>
                </div>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> 使用说明</h3>
                    <ul>
                        <li>首先上传一个带有透明通道的PNG图片作为前景</li>
                        <li>使用滑块调整背景灰度值，范围从0(黑色)到255(白色)</li>
                        <li>可以上传一张图片作为背景，覆盖灰度背景</li>
                        <li>点击"清除背景图片"按钮可恢复灰度背景</li>
                        <li>背景使用棋盘格图案表示透明区域</li>
                    </ul>
                </div>
            </div>
            
            <div class="preview">
                <h2><i class="fas fa-eye"></i> 预览效果</h2>
                <div class="preview-container">
                    <div id="backgroundDisplay"></div>
                    <img id="foregroundImage" src="" alt="RGBA图片预览">
                </div>
                
                <div class="image-info">
                    <div class="info-item">
                        <span>前景图片:</span>
                        <span id="foregroundInfo">未上传</span>
                    </div>
                    <div class="info-item">
                        <span>背景类型:</span>
                        <span id="backgroundType">灰度 (127)</span>
                    </div>
                    <div class="info-item">
                        <span>前景尺寸:</span>
                        <span id="imageDimensions">-</span>
                    </div>
                    <div class="info-item">
                        <span>文件大小:</span>
                        <span id="fileSize">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const foregroundInput = document.getElementById('foregroundInput');
            const foregroundUploadArea = document.getElementById('foregroundUploadArea');
            const backgroundInput = document.getElementById('backgroundInput');
            const backgroundUploadArea = document.getElementById('backgroundUploadArea');
            const grayscaleSlider = document.getElementById('grayscaleSlider');
            const grayscaleValue = document.getElementById('grayscaleValue');
            const colorIndicator = document.getElementById('colorIndicator');
            const backgroundDisplay = document.getElementById('backgroundDisplay');
            const foregroundImage = document.getElementById('foregroundImage');
            const clearBackgroundBtn = document.getElementById('clearBackgroundBtn');
            const foregroundStatus = document.getElementById('foregroundStatus');
            const backgroundStatus = document.getElementById('backgroundStatus');
            const foregroundInfo = document.getElementById('foregroundInfo');
            const backgroundType = document.getElementById('backgroundType');
            const imageDimensions = document.getElementById('imageDimensions');
            const fileSize = document.getElementById('fileSize');
            
            // 当前状态
            let currentBackgroundType = 'grayscale'; // 'grayscale' 或 'image'
            let currentBackgroundImage = null;
            
            // 设置初始背景
            updateBackground();
            
            // 前景图片上传处理
            foregroundUploadArea.addEventListener('click', () => foregroundInput.click());
            
            foregroundInput.addEventListener('change', function(e) {
                if (this.files && this.files[0]) {
                    const file = this.files[0];
                    
                    // 检查文件类型
                    if (!file.type.match('image/png')) {
                        showStatus(foregroundStatus, '错误：请上传PNG格式图片', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        foregroundImage.src = e.target.result;
                        showStatus(foregroundStatus, '前景图片上传成功！', 'success');
                        
                        // 更新图片信息
                        const img = new Image();
                        img.onload = function() {
                            imageDimensions.textContent = `${this.width} × ${this.height} 像素`;
                            fileSize.textContent = formatFileSize(file.size);
                        };
                        img.src = e.target.result;
                        
                        foregroundInfo.textContent = file.name;
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
            
            // 背景图片上传处理
            backgroundUploadArea.addEventListener('click', () => backgroundInput.click());
            
            backgroundInput.addEventListener('change', function(e) {
                if (this.files && this.files[0]) {
                    const file = this.files[0];
                    
                    // 检查文件类型
                    if (!file.type.match('image.*')) {
                        showStatus(backgroundStatus, '错误：请上传图片文件', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        currentBackgroundType = 'image';
                        currentBackgroundImage = e.target.result;
                        updateBackground();
                        showStatus(backgroundStatus, '背景图片上传成功！', 'success');
                        backgroundType.textContent = '自定义图片';
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
            
            // 清除背景图片
            clearBackgroundBtn.addEventListener('click', function() {
                currentBackgroundType = 'grayscale';
                currentBackgroundImage = null;
                backgroundInput.value = '';
                updateBackground();
                showStatus(backgroundStatus, '背景图片已清除', 'success');
                backgroundType.textContent = `灰度 (${grayscaleSlider.value})`;
            });
            
            // 灰度滑块事件
            grayscaleSlider.addEventListener('input', function() {
                const value = this.value;
                grayscaleValue.textContent = value;
                colorIndicator.style.backgroundColor = `rgb(${value}, ${value}, ${value})`;
                
                if (currentBackgroundType === 'grayscale') {
                    updateBackground();
                    backgroundType.textContent = `灰度 (${value})`;
                }
            });
            
            // 拖放功能
            setupDragAndDrop(foregroundUploadArea, foregroundInput);
            setupDragAndDrop(backgroundUploadArea, backgroundInput);
            
            // 更新背景显示
            function updateBackground() {
                if (currentBackgroundType === 'image' && currentBackgroundImage) {
                    backgroundDisplay.style.backgroundImage = `url(${currentBackgroundImage})`;
                    backgroundDisplay.style.backgroundColor = '';
                } else {
                    const grayValue = grayscaleSlider.value;
                    backgroundDisplay.style.backgroundColor = `rgb(${grayValue}, ${grayValue}, ${grayValue})`;
                    backgroundDisplay.style.backgroundImage = '';
                }
                
                // 设置背景样式
                backgroundDisplay.style.backgroundSize = 'cover';
                backgroundDisplay.style.backgroundPosition = 'center';
                backgroundDisplay.style.backgroundRepeat = 'no-repeat';
            }
            
            // 设置拖放功能
            function setupDragAndDrop(dropArea, inputElement) {
                dropArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#ff7e5f';
                    this.style.backgroundColor = 'rgba(74, 157, 240, 0.3)';
                });
                
                dropArea.addEventListener('dragleave', function() {
                    this.style.borderColor = '#4a9df0';
                    this.style.backgroundColor = 'rgba(74, 157, 240, 0.1)';
                });
                
                dropArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#4a9df0';
                    this.style.backgroundColor = 'rgba(74, 157, 240, 0.1)';
                    
                    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                        inputElement.files = e.dataTransfer.files;
                        const event = new Event('change', { bubbles: true });
                        inputElement.dispatchEvent(event);
                    }
                });
            }
            
            // 显示状态消息
            function showStatus(element, message, type) {
                element.textContent = message;
                element.className = 'status ' + type;
                
                // 3秒后隐藏消息
                setTimeout(() => {
                    element.style.display = 'none';
                }, 3000);
            }
            
            // 格式化文件大小
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        });
    </script>
</body>
</html>